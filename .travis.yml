language: ruby

env:
  global:
    - APP_BUNDLE_SRC=./vendor/src

rvm:
  - 2.3.1

before_install:
  - gem install bundler
  - cd sixthedge/cellar/local

install:
  - ./install.sh --package opentbl/api --install ../../opentbl --platform thinkspace
  - cp -a sixthedge/cellar/src/thinkspace/api sixthedge/opentbl/vendor/src/thinkspace/api
  - cp -a sixthedge/cellar/src/totem/api sixthedge/opentbl/vendor/src/totem/api
  - bundle install

script:
  - echo Skipping script step...

before_deploy:
  - cd opentbl
  - rails railties:install:migrations

deploy:
  provider: heroku
  api_key:
    secure: encrypted-key-here
  app: opentbl-testing
  run:
    - "rails totem:db:production_migrate"
    - "rails totem:db:domain:load"
