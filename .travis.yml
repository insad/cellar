language: ruby

env:
  global:
    - APP_BUNDLE_SRC=./vendor/src

rvm:
  - 2.3.1

before_install:
  - echo Building from $TRAVIS_BUILD_DIR
  - gem install bundler
  - cd local

install:
  - ./install.sh --package opentbl/api --install $TRAVIS_BUILD_DIR/opentbl --platform thinkspace
  - cp -a $TRAVIS_BUILD_DIR/src/thinkspace/api $TRAVIS_BUILD_DIR/opentbl/vendor/src/thinkspace/api
  - cp -a $TRAVIS_BUILD_DIR/src/totem/api $TRAVIS_BUILD_DIR/opentbl/vendor/src/totem/api
  - cd $TRAVIS_BUILD_DIR/opentbl
  - bundle install

script:
  - echo Skipping script step...

before_deploy:
  - cd opentbl
  - rails railties:install:migrations

deploy:
  provider: heroku
  api_key:
    secure: encrypted-key-here
  app: opentbl-testing
  run:
    - "rails totem:db:production_migrate"
    - "rails totem:db:domain:load"
